#!/bin/bash

set -e

BASE_DIR="/opt/concourse"

export USERNAME="$(curl http://169.254.169.254/latest/user-data | $BASE_DIR/bin/extract_yaml_key username <%= @ci_default_username %>)"
export PASSWORD="$(curl http://169.254.169.254/latest/user-data | $BASE_DIR/bin/extract_yaml_key password <%= @ci_default_password %>)"
export PIPELINE="$(curl http://169.254.169.254/latest/user-data | $BASE_DIR/bin/extract_yaml_key pipeline)"

export AWS_HOSTNAME="$(curl http://169.254.169.254/latest/meta-data/public-hostname)"

export HOSTNAME="$(curl http://169.254.169.254/latest/user-data | $BASE_DIR/bin/extract_yaml_key hostname $AWS_HOSTNAME)"
